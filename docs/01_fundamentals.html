<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>R training: Liverpool City Region - 1&nbsp; R Fundamentals</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./02_data-visualisation.html" rel="next">
<link href="./00_overview.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./01_fundamentals.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">R Fundamentals</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">R training: Liverpool City Region</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/fcorowe/lcr-training" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00_overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_fundamentals.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">R Fundamentals</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_data-visualisation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data Visualisation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_dashboards-api.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Dashboards and APIs</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_data-modeling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data modeling</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_data-description.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar"><div class="quarto-margin-header"><div class="margin-header-item">
<p><img src="./cover.png" class="img-fluid"></p>
</div></div>
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#learning-objectives" id="toc-learning-objectives" class="nav-link active" data-scroll-target="#learning-objectives"><span class="header-section-number">1.1</span> Learning Objectives</a></li>
  <li><a href="#plan-for-the-day" id="toc-plan-for-the-day" class="nav-link" data-scroll-target="#plan-for-the-day"><span class="header-section-number">1.2</span> Plan for the day</a></li>
  <li><a href="#dependencies" id="toc-dependencies" class="nav-link" data-scroll-target="#dependencies"><span class="header-section-number">1.3</span> Dependencies</a></li>
  <li><a href="#introducing-r" id="toc-introducing-r" class="nav-link" data-scroll-target="#introducing-r"><span class="header-section-number">1.4</span> Introducing R</a></li>
  <li><a href="#working-directory" id="toc-working-directory" class="nav-link" data-scroll-target="#working-directory"><span class="header-section-number">1.5</span> Working directory</a></li>
  <li><a href="#r-scripts" id="toc-r-scripts" class="nav-link" data-scroll-target="#r-scripts"><span class="header-section-number">1.6</span> R scripts</a></li>
  <li><a href="#quarto-document" id="toc-quarto-document" class="nav-link" data-scroll-target="#quarto-document"><span class="header-section-number">1.7</span> Quarto Document</a>
  <ul class="collapse">
  <li><a href="#using-quarto-documents" id="toc-using-quarto-documents" class="nav-link" data-scroll-target="#using-quarto-documents"><span class="header-section-number">1.7.1</span> Using quarto documents</a></li>
  </ul></li>
  <li><a href="#help" id="toc-help" class="nav-link" data-scroll-target="#help"><span class="header-section-number">1.8</span> Help</a></li>
  <li><a href="#r-data-types" id="toc-r-data-types" class="nav-link" data-scroll-target="#r-data-types"><span class="header-section-number">1.9</span> R data types</a>
  <ul class="collapse">
  <li><a href="#factors" id="toc-factors" class="nav-link" data-scroll-target="#factors"><span class="header-section-number">1.9.1</span> Factors</a></li>
  </ul></li>
  <li><a href="#data-frames" id="toc-data-frames" class="nav-link" data-scroll-target="#data-frames"><span class="header-section-number">1.10</span> Data frames</a>
  <ul class="collapse">
  <li><a href="#non-geographic-data-frames" id="toc-non-geographic-data-frames" class="nav-link" data-scroll-target="#non-geographic-data-frames"><span class="header-section-number">1.10.1</span> Non-geographic data frames</a></li>
  <li><a href="#geographic-data-frames" id="toc-geographic-data-frames" class="nav-link" data-scroll-target="#geographic-data-frames"><span class="header-section-number">1.10.2</span> Geographic data frames</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">R Fundamentals</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>This session will introduce the fundamental concepts, principles and tools that we will use during the course. Understanding these components provides the foundation for the rest of the course. We will introduce key concepts and functions relating to what computational notebooks are and how they work. We will also cover basic R functions and data types, including the use of factors. Additionally, we will offer a basic understanding of the manipulation non-geographic and geographic data frames using commonly used libraries the tidyverse and r-spatial ecosystems, including sf.</p>
<section id="learning-objectives" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="learning-objectives"><span class="header-section-number">1.1</span> Learning Objectives</h2>
<p>By the end of today’s session you should be able to:</p>
<ol type="1">
<li>Be familiar with R, RStudio, Quarto and R programming.</li>
<li>Handle different data types, including numeric, string and factors.</li>
<li>Understand how to create and handle non-geographic and geographic data frames.</li>
<li>Be familiar with common R packages, including the tidyverse and r-spatial ecosystems.</li>
</ol>
</section>
<section id="plan-for-the-day" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="plan-for-the-day"><span class="header-section-number">1.2</span> Plan for the day</h2>
<table class="table">
<thead>
<tr class="header">
<th>Time</th>
<th>Content</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>10.00 - 10.15</td>
<td>Introduction</td>
</tr>
<tr class="even">
<td>10.15 - 10.45</td>
<td>Setting up &amp; interacting with materials</td>
</tr>
<tr class="odd">
<td>10.45 - 11.30</td>
<td>R Basics</td>
</tr>
<tr class="even">
<td>11.30 - 11.50</td>
<td>Break</td>
</tr>
<tr class="odd">
<td>11.50 - 12.50</td>
<td>Using Quarto documents &amp; Data types</td>
</tr>
<tr class="even">
<td>12.50 - 13.30</td>
<td>Lunch</td>
</tr>
<tr class="odd">
<td>13.30 - 14.15</td>
<td>Non-geographic data frames</td>
</tr>
<tr class="even">
<td>14.15 - 14.45</td>
<td>Geographic data frames</td>
</tr>
<tr class="odd">
<td>14.45 - 15.00</td>
<td>Questions &amp; closing</td>
</tr>
</tbody>
</table>
</section>
<section id="dependencies" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="dependencies"><span class="header-section-number">1.3</span> Dependencies</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># data manipulation</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># spatial data manipulation</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="introducing-r" class="level2 page-columns page-full" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="introducing-r"><span class="header-section-number">1.4</span> Introducing R</h2>
<p>R is a freely available language and environment for statistical computing and graphics which provides a wide variety of statistical and graphical techniques. It has gained widespread use in academia and industry. R offers a wider array of functionality than a traditional statistics package, is composed of core (base) functionality, and is expandable through libraries hosted on <a href="https://cran.r-project.org">The Comprehensive R Archive Network (CRAN)</a>. CRAN is a network of ftp and web servers around the world that store identical, up-to-date, versions of code and documentation for R.</p>
<p>Commands are sent to R using either the terminal / command line or the R Console which is installed with R on either Windows or OS X. On Linux, there is no equivalent of the console, however, third party solutions exist. On your own machine, R can be installed from <a href="https://www.r-project.org">here</a>.</p>
<p>Normally RStudio is used to implement R coding. <a href="https://posit.co/download/rstudio-desktop/">RStudio</a> is an integrated development environment (IDE) for R and provides a more user-friendly front-end to R than the front-end provided with R.</p>
<p>To run R or RStudio, just double click on the R or RStudio icon. Throughout this course, we will be using RStudio:</p>
<p><img src="./figs/01/rstudio-shot.png" class="img-fluid"></p>

<div class="no-row-height column-margin column-container"><div class="">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you would like to know more about the various features of RStudio, read this <a href="https://www.datacamp.com/tutorial/r-studio-tutorial">post</a>.</p>
</div>
</div>
</div></div></section>
<section id="working-directory" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="working-directory"><span class="header-section-number">1.5</span> Working directory</h2>
<p>Before we start any analysis, ensure to set the path to the directory where we are working. We have two options to do this.</p>
<p><strong>Option 1</strong></p>
<p>Once you have opened R, you can use the command <code>setwd( )</code> to set the working directory. For example, replace in the following line the path to the folder where you have placed this file and where the data folder lives.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can check your current working directory by typing:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getwd</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Option 2</strong></p>
<p>Before opening any files in the folder, open the file with the extension <code>*.Rproj</code>. This is a R project and automatically indexes all the files in the folder and subfolders so there is no need to explicitly set the working directory. You can call any files in the R project folder by replacing the working directory with “<code>.</code>”. For instance, let us open a dataset from our subfolder data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="st">"./data/census2021-ts061-lsoa.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="r-scripts" class="level2 page-columns page-full" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="r-scripts"><span class="header-section-number">1.6</span> R scripts</h2>
<p>An <em>R script</em> is a series of commands that you can execute at one time and help you save time. R scripts are useful to ensure reproducibility; that is if you want to repeat the same series of steps with the same or different datasets. An R script is a plain text file with R commands.</p>

<div class="no-row-height column-margin column-container"><div class="">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>To get familiar with good practices in writing your code in R, we recommend the Chapter Workflow: basics and Workflow: scripts and projects from the R in Data Science book by <a href="https://r4ds.hadley.nz/workflow-basics.html">Wickham, Çetinkaya-Rundel, and Grolemund (2023)</a></p>
</div>
</div>
</div></div><p>To create an R script in RStudio, you need to:</p>
<ul>
<li><p>Open a new script file: File &gt; New File &gt; R Script</p></li>
<li><p>Write some code on your new script window by typing eg. mtcars</p></li>
<li><p>Run the script. Click anywhere on the line of code, then hit Ctrl + Enter (Windows) or Cmd + Enter (Mac) to run the command or select the code chunk and click run on the right-top corner of your script window. If do that, you should get:</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>mtcars</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                     mpg cyl  disp  hp drat    wt  qsec vs am gear carb
Mazda RX4           21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
Mazda RX4 Wag       21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
Datsun 710          22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1
Hornet 4 Drive      21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1
Hornet Sportabout   18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2
Valiant             18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1
Duster 360          14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4
Merc 240D           24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2
Merc 230            22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2
Merc 280            19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4
Merc 280C           17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4
Merc 450SE          16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3
Merc 450SL          17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3
Merc 450SLC         15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3
Cadillac Fleetwood  10.4   8 472.0 205 2.93 5.250 17.98  0  0    3    4
Lincoln Continental 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4
Chrysler Imperial   14.7   8 440.0 230 3.23 5.345 17.42  0  0    3    4
Fiat 128            32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1
Honda Civic         30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2
Toyota Corolla      33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1
Toyota Corona       21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1
Dodge Challenger    15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2
AMC Javelin         15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2
Camaro Z28          13.3   8 350.0 245 3.73 3.840 15.41  0  0    3    4
Pontiac Firebird    19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2
Fiat X1-9           27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1
Porsche 914-2       26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2
Lotus Europa        30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2
Ford Pantera L      15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4
Ferrari Dino        19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6
Maserati Bora       15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8
Volvo 142E          21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2</code></pre>
</div>
</div>
<ul>
<li>Save the script:&nbsp;<em>File</em>&nbsp;&gt;&nbsp;<em>Save As</em>, select your required destination folder, and enter any filename that you like, provided that it ends with the file extension&nbsp;<em>.R</em></li>
</ul>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Task</strong></p>
<p>Open and create a basic R Script</p>
</div>
</div>
</div>
</section>
<section id="quarto-document" class="level2" data-number="1.7">
<h2 data-number="1.7" class="anchored" data-anchor-id="quarto-document"><span class="header-section-number">1.7</span> Quarto Document</h2>
<p>A <em>Quarto Document</em> is based on Markdown technology. It allows to integrate descriptive text and code chunks. Code chunks can be executed independently and interactively, with output visible immediately beneath a code chunk - see <span class="citation" data-cites="xie2018">Xie, Allaire, and Grolemund (<a href="references.html#ref-xie2018" role="doc-biblioref">2018</a>)</span>. A Quarto Document is an improved version of the original R Notebook. Quarto Document requires a package called Quarto. Quarto does not have a dependency or requirement for R. Quarto is multilingual, beginning with R, Python, Javascript, and Julia. The concept is that Quarto will work even for languages that do not yet exist.</p>
<p>To create a Quarto Document, you need to:</p>
<ul>
<li><p>Open a new script file: File &gt; New File &gt; Quarto Document.</p></li>
<li><p>Quarto Documents work in the same way as R Notebooks with small variations. You can find a comprehensive guide on how to use Quarto Documents on the Quarto website.</p></li>
</ul>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Task</strong></p>
<p>Open, create, preview and render a Quarto Document</p>
</div>
</div>
</div>
<p>Now that you are familiar with Quarto, we will explore some basic elements:</p>
<ul>
<li><p>YAML options</p></li>
<li><p>Code chunks</p></li>
<li><p>Preview</p></li>
<li><p>Rendering</p></li>
</ul>
<p>To master Quarto, please read the <a href="https://quarto.org/docs/guide/">Quarto Guide page</a>.</p>
<section id="using-quarto-documents" class="level3" data-number="1.7.1">
<h3 data-number="1.7.1" class="anchored" data-anchor-id="using-quarto-documents"><span class="header-section-number">1.7.1</span> Using quarto documents</h3>
<p>Quarto documents are very flexible. They can be rendered into different formats, including pdf, html and doc files. They can be used to product reports, articles, briefs, websites, books and more. We can explore how this can be done using some of the templates we have produced and are hosted on our personal <a href="https://github.com/fcorowe/research-article-template">Github</a> repository.</p>
<p>Let us explore the use of Quarto documents by downloading the repository above and examine the various templates available.</p>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Task</strong></p>
<p>Include your name and affiliation on one of the Quarto Document templates. Also try changing the font family.</p>
</div>
</div>
</div>
</section>
</section>
<section id="help" class="level2" data-number="1.8">
<h2 data-number="1.8" class="anchored" data-anchor-id="help"><span class="header-section-number">1.8</span> Help</h2>
<p>You can use&nbsp;<code>help</code>&nbsp;or&nbsp;<code>?</code>&nbsp;to ask for details for a specific function:</p>
<pre><code>help(sqrt) #or ?sqrt
?ggplot</code></pre>
<p>And using&nbsp;<code>example</code>&nbsp;provides examples for said function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">example</span>(geom_map)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
gem_mp&gt; # First, a made-up example containing a few polygons, to explain
gem_mp&gt; # how `geom_map()` works. It requires two data frames:
gem_mp&gt; # One contains the coordinates of each polygon (`positions`), and is
gem_mp&gt; # provided via the `map` argument. The other contains the
gem_mp&gt; # other the values associated with each polygon (`values`).  An id
gem_mp&gt; # variable links the two together.
gem_mp&gt; 
gem_mp&gt; ids &lt;- factor(c("1.1", "2.1", "1.2", "2.2", "1.3", "2.3"))

gem_mp&gt; values &lt;- data.frame(
gem_mp+   id = ids,
gem_mp+   value = c(3, 3.1, 3.1, 3.2, 3.15, 3.5)
gem_mp+ )

gem_mp&gt; positions &lt;- data.frame(
gem_mp+   id = rep(ids, each = 4),
gem_mp+   x = c(2, 1, 1.1, 2.2, 1, 0, 0.3, 1.1, 2.2, 1.1, 1.2, 2.5, 1.1, 0.3,
gem_mp+   0.5, 1.2, 2.5, 1.2, 1.3, 2.7, 1.2, 0.5, 0.6, 1.3),
gem_mp+   y = c(-0.5, 0, 1, 0.5, 0, 0.5, 1.5, 1, 0.5, 1, 2.1, 1.7, 1, 1.5,
gem_mp+   2.2, 2.1, 1.7, 2.1, 3.2, 2.8, 2.1, 2.2, 3.3, 3.2)
gem_mp+ )

gem_mp&gt; ggplot(values) +
gem_mp+   geom_map(aes(map_id = id), map = positions) +
gem_mp+   expand_limits(positions)</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="01_fundamentals_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
gem_mp&gt; ggplot(values, aes(fill = value)) +
gem_mp+   geom_map(aes(map_id = id), map = positions) +
gem_mp+   expand_limits(positions)</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="01_fundamentals_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
gem_mp&gt; ggplot(values, aes(fill = value)) +
gem_mp+   geom_map(aes(map_id = id), map = positions) +
gem_mp+   expand_limits(positions) + ylim(0, 3)</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="01_fundamentals_files/figure-html/unnamed-chunk-6-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
gem_mp&gt; # Now some examples with real maps
gem_mp&gt; if (require(maps)) {
gem_mp+ 
gem_mp+   crimes &lt;- data.frame(state = tolower(rownames(USArrests)), USArrests)
gem_mp+ 
gem_mp+   # Equivalent to crimes %&gt;% tidyr::pivot_longer(Murder:Rape)
gem_mp+   vars &lt;- lapply(names(crimes)[-1], function(j) {
gem_mp+     data.frame(state = crimes$state, variable = j, value = crimes[[j]])
gem_mp+   })
gem_mp+   crimes_long &lt;- do.call("rbind", vars)
gem_mp+ 
gem_mp+   states_map &lt;- map_data("state")
gem_mp+ 
gem_mp+   # without geospatial coordinate system, the resulting plot
gem_mp+   # looks weird
gem_mp+   ggplot(crimes, aes(map_id = state)) +
gem_mp+     geom_map(aes(fill = Murder), map = states_map) +
gem_mp+     expand_limits(x = states_map$long, y = states_map$lat)
gem_mp+ 
gem_mp+   # in combination with `coord_sf()` we get an appropriate result
gem_mp+   ggplot(crimes, aes(map_id = state)) +
gem_mp+     geom_map(aes(fill = Murder), map = states_map) +
gem_mp+     # crs = 5070 is a Conus Albers projection for North America,
gem_mp+     #   see: https://epsg.io/5070
gem_mp+     # default_crs = 4326 tells coord_sf() that the input map data
gem_mp+     #   are in longitude-latitude format
gem_mp+     coord_sf(
gem_mp+       crs = 5070, default_crs = 4326,
gem_mp+       xlim = c(-125, -70), ylim = c(25, 52)
gem_mp+     )
gem_mp+ 
gem_mp+  ggplot(crimes_long, aes(map_id = state)) +
gem_mp+    geom_map(aes(fill = value), map = states_map) +
gem_mp+    coord_sf(
gem_mp+      crs = 5070, default_crs = 4326,
gem_mp+      xlim = c(-125, -70), ylim = c(25, 52)
gem_mp+    ) +
gem_mp+    facet_wrap(~variable)
gem_mp+ }</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="01_fundamentals_files/figure-html/unnamed-chunk-6-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Task</strong></p>
<p>Ask for help for a different function.</p>
</div>
</div>
</div>
</section>
<section id="r-data-types" class="level2" data-number="1.9">
<h2 data-number="1.9" class="anchored" data-anchor-id="r-data-types"><span class="header-section-number">1.9</span> R data types</h2>
<p>There are a number of data types. Four are the most common. In R, numeric is the default type for numbers. It stores all numbers as floating-point numbers (numbers with decimals). This is because most statistical calculations deal with numbers with up to two decimals.</p>
<p>Before starting with the various data types which R can handle, we should understand that any element appearing in our R environment is called a R object and they can take different shapes. It could be a single character, a vector, a matrix, a list or have a more complex structure.</p>
<p>Numeric</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>num <span class="ot">&lt;-</span> <span class="fl">4.5</span> <span class="co"># Decimal values</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(num)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "numeric"</code></pre>
</div>
</div>
<p>Integer</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>int <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="dv">4</span>) <span class="co"># Natural numbers. Note integers are also numerics.</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(int)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "integer"</code></pre>
</div>
</div>
<p>Character</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>cha <span class="ot">&lt;-</span> <span class="st">"are you enjoying this?"</span> <span class="co"># text or string. You can also type `as.character("are you enjoying this?")`</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(cha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "character"</code></pre>
</div>
</div>
<p>Logical</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>log <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">&lt;</span> <span class="dv">1</span> <span class="co"># assigns TRUE or FALSE. In this case, FALSE as 2 is greater than 1</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>log</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(log)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "logical"</code></pre>
</div>
</div>
<p>You can create vectors by concatenating elements:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>data_vector <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>data_vector</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2 3 4 5 6</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Task</strong></p>
<p>Create a variable called income, with the following five respondent values: high, low, low, middle, high.</p>
</div>
</div>
</div>
<section id="factors" class="level3" data-number="1.9.1">
<h3 data-number="1.9.1" class="anchored" data-anchor-id="factors"><span class="header-section-number">1.9.1</span> Factors</h3>
<p>A factor variable assigns a numeric code to each possible category (level) in a variable. Behind the scenes, R stores the variable using these numeric codes to save space and speed up computing. For example, compare the size of a list of 10,000 males and females to a list of 10,000 1s and 0s. At the same time R also saves the category names associated with each numeric code (level). These are used for display purposes.</p>
<p>For example, the variable gender, converted to a factor, would be stored as a series of 1s and 2s, where 1 = female and 2 = male; but would be displayed in all outputs using their category labels of female and male.</p>
<p><strong>Defining a factor</strong></p>
<p>A factor can be defined by first creating a numeric or character vector; for example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>gender <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"female"</span>, <span class="st">"male"</span>, <span class="st">"male"</span>, <span class="st">"female"</span>, <span class="st">"female"</span>) <span class="co"># create a gender variable</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>gender <span class="ot">&lt;-</span> <span class="fu">factor</span>(gender) <span class="co"># replace character vector with a factor version</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>gender</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] female male   male   female female
Levels: female male</code></pre>
</div>
</div>
<p>We can ask the class of <code>gender</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "factor"</code></pre>
</div>
</div>
<p>And also its structure:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Factor w/ 2 levels "female","male": 1 2 2 1 1</code></pre>
</div>
</div>
<p><code>gender</code> is a factor and is stored as a series of 1s and 2s, with 1s representing females and 2s representing males. The function levels( ) lists the levels (categories) associated with a given factor variable:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "female" "male"  </code></pre>
</div>
</div>
<p>The categories are reported in the order that they have been numbered (starting from 1). Hence from the output we can infer that females are coded as 1, and males as 2. Factor variables are useful to encode categorical or qualitative data; that is, data on nominal or ordinal scales.</p>
<p><strong>Defining an ordered factor</strong></p>
<p>By default the levels of the factor (variable categories) are allocated in alphabetical order. Hence in the example above <code>female = 1</code> and <code>male = 2</code>.</p>
<p>Sometimes an alternative ordering is required, for example <code>male = 1</code> and <code>female = 2</code>.</p>
<p>For nominal variables, the solution is to specify the required order of the levels when calling the <code>factor( )</code> function via the <code>levels( )</code> sub-command:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>gender2 <span class="ot">&lt;-</span> <span class="fu">factor</span>(gender, <span class="at">levels=</span> <span class="fu">c</span>(<span class="st">"male"</span>, <span class="st">"female"</span>))</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>gender2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] female male   male   female female
Levels: male female</code></pre>
</div>
</div>
<p><strong>Using a factor to define nominal and ordinal variables</strong></p>
<p>For ordinal variables, such as income (income bracket), we create an ordered factor by calling the <code>ordered( )</code> rather than <code>factor( )</code> function, including a call to the sub-command <code>levels( )</code> which specifies the required category order:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>income <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"high"</span>, <span class="st">"low"</span>, <span class="st">"low"</span>, <span class="st">"middle"</span>, <span class="st">"high"</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>income <span class="ot">&lt;-</span> <span class="fu">ordered</span>(income, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"low"</span>, <span class="st">"middle"</span>, <span class="st">"high"</span>))</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>income</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] high   low    low    middle high  
Levels: low &lt; middle &lt; high</code></pre>
</div>
</div>
<p>Let us explore its class, structure and levels:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(income)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "ordered" "factor" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(income)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Ord.factor w/ 3 levels "low"&lt;"middle"&lt;..: 3 1 1 2 3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(income)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "low"    "middle" "high"  </code></pre>
</div>
</div>
<p>Note that if we do not use the <code>levels( )</code> sub-command, then the default behaviour of <code>ordered( )</code> is to order the categories alphabetically, like <code>factor( )</code>.</p>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Task</strong></p>
<p>Run the following line of code, then convert the resulting variable into a factor with the categories ordered car, train, bus, bicycle:</p>
<p><code>travel_mode &lt;- c("train", "bicycle", "bus", "car", "car")</code></p>
</div>
</div>
</div>
</section>
</section>
<section id="data-frames" class="level2 page-columns page-full" data-number="1.10">
<h2 data-number="1.10" class="anchored" data-anchor-id="data-frames"><span class="header-section-number">1.10</span> Data frames</h2>
<p>R stores different types of data using different types of data structure. Data are normally stored as a data.frame. Data frames are a special R object. A data frame contains one row per observation and one column per attribute. In this course, we distinguish between non-geographic and geographic data frames.</p>
<section id="non-geographic-data-frames" class="level3 page-columns page-full" data-number="1.10.1">
<h3 data-number="1.10.1" class="anchored" data-anchor-id="non-geographic-data-frames"><span class="header-section-number">1.10.1</span> Non-geographic data frames</h3>
<p>Non-geographic data frames are data structures which have no indexed spatial elements as we will see below.</p>
<p><strong>Reading data frames</strong></p>
<p>We will start by illustrating how data frames can be read from our local hard drive. R has many commands to read and load data objects. The command to use will depend upon the format they have been saved. Normally they are saved in csv format from Excel or other software packages. So we use either of these lines of code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"path/file_name.csv"</span>, <span class="at">header =</span> <span class="cn">FALSE</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">"path/file_name.csv"</span>, <span class="at">header =</span> <span class="cn">FALSE</span>, <span class="at">sep =</span><span class="st">","</span>)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read</span>(<span class="st">"path/file_name.csv"</span>, <span class="at">header =</span> <span class="cn">FALSE</span>)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">"path/file_name.csv"</span>, <span class="at">header =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let us use the first option to read some 2021 Census data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>df_census <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./data/census2021-ts061-lsoa.csv"</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(df_census)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   35672 obs. of  15 variables:
 $ date                                                                                                                     : int  2021 2021 2021 2021 2021 2021 2021 2021 2021 2021 ...
 $ geography                                                                                                                : chr  "City of London 001A" "City of London 001B" "City of London 001C" "City of London 001E" ...
 $ geography.code                                                                                                           : chr  "E01000001" "E01000002" "E01000003" "E01000005" ...
 $ Method.of.travel.to.workplace..Total..All.usual.residents.aged.16.years.and.over.in.employment.the.week.before.the.census: int  866 881 1000 496 888 1385 651 784 740 904 ...
 $ Method.of.travel.to.workplace..Work.mainly.at.or.from.home                                                               : int  639 676 618 203 192 370 80 163 136 188 ...
 $ Method.of.travel.to.workplace..Underground..metro..light.rail..tram                                                      : int  35 31 74 69 205 358 126 201 155 203 ...
 $ Method.of.travel.to.workplace..Train                                                                                     : int  17 10 21 25 104 177 74 96 88 112 ...
 $ Method.of.travel.to.workplace..Bus..minibus.or.coach                                                                     : int  13 15 26 44 60 117 125 70 86 98 ...
 $ Method.of.travel.to.workplace..Taxi                                                                                      : int  4 2 4 2 1 8 4 1 1 10 ...
 $ Method.of.travel.to.workplace..Motorcycle..scooter.or.moped                                                              : int  3 1 4 3 5 3 3 4 3 5 ...
 $ Method.of.travel.to.workplace..Driving.a.car.or.van                                                                      : int  18 19 24 33 227 220 176 166 174 203 ...
 $ Method.of.travel.to.workplace..Passenger.in.a.car.or.van                                                                 : int  0 3 7 1 10 21 11 19 28 12 ...
 $ Method.of.travel.to.workplace..Bicycle                                                                                   : int  24 25 62 18 6 21 6 5 12 14 ...
 $ Method.of.travel.to.workplace..On.foot                                                                                   : int  109 92 143 90 61 71 40 44 42 38 ...
 $ Method.of.travel.to.workplace..Other.method.of.travel.to.work                                                            : int  4 7 17 8 17 19 6 15 15 21 ...</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Task</strong></p>
<p>Let us inspect the data: What class is the data frame? What data type are the variables in the data frame? What are the name of all columns in the data frame?</p>
</div>
</div>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>To read files in other formats, refer to this useful <a href="https://www.datacamp.com/tutorial/r-data-import-tutorial#csv">DataCamp tutorial</a>.</p>
</div>
</div>
</div></div><p><strong>Creating data frames</strong></p>
<p>We can also create a data frame from scratch within R. We first need to create each column independently. We create three variables: <code>lt_la</code> (lower tier local authorities), <code>deprivation_category</code> and <code>deprivation</code> based on the 2021 census data on deprivation from the <a href="https://www.ons.gov.uk/datasets/TS011/editions/2021/versions/6/filter-outputs/628653ca-2c26-4fed-8ed4-322e3b16634c#get-data">ONS website</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>lt_la <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Knowsley"</span>, <span class="st">"Knowsley"</span>, <span class="st">"Knowsley"</span>, <span class="st">"Knowsley"</span>, <span class="st">"Knowsley"</span>, <span class="st">"Knowsley"</span>, <span class="st">"Liverpool"</span>, <span class="st">"Liverpool"</span>, <span class="st">"Liverpool"</span>, <span class="st">"Liverpool"</span>, <span class="st">"Liverpool"</span>, <span class="st">"Liverpool"</span>, <span class="st">"St. Helens"</span>, <span class="st">"St. Helens"</span>, <span class="st">"St. Helens"</span>, <span class="st">"St. Helens"</span>, <span class="st">"St. Helens"</span>, <span class="st">"St. Helens"</span>, <span class="st">"Sefton"</span>, <span class="st">"Sefton"</span>, <span class="st">"Sefton"</span>, <span class="st">"Sefton"</span>, <span class="st">"Sefton"</span>, <span class="st">"Sefton"</span>, <span class="st">"Wirral"</span>, <span class="st">"Wirral"</span>, <span class="st">"Wirral"</span>, <span class="st">"Wirral"</span>, <span class="st">"Wirral"</span>, <span class="st">"Wirral"</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>deprivation_category <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Does not apply"</span>, <span class="st">"Household is not deprived in any dimension"</span>, <span class="st">"Household is deprived in one dimension"</span>, <span class="st">"Household is deprived in two dimensions"</span>, <span class="st">"Household is deprived in three dimensions"</span>, <span class="st">"Household is deprived in four dimensions"</span>, <span class="st">"Does not apply"</span>, <span class="st">"Household is not deprived in any dimension"</span>, <span class="st">"Household is deprived in one dimension"</span>, <span class="st">"Household is deprived in two dimensions"</span>, <span class="st">"Household is deprived in three dimensions"</span>, <span class="st">"Household is deprived in four dimensions"</span>, <span class="st">"Does not apply"</span>, <span class="st">"Household is not deprived in any dimension"</span>, <span class="st">"Household is deprived in one dimension"</span>, <span class="st">"Household is deprived in two dimensions"</span>, <span class="st">"Household is deprived in three dimensions"</span>, <span class="st">"Household is deprived in four dimensions"</span>, <span class="st">"Does not apply"</span>, <span class="st">"Household is not deprived in any dimension"</span>, <span class="st">"Household is deprived in one dimension"</span>, <span class="st">"Household is deprived in two dimensions"</span>, <span class="st">"Household is deprived in three dimensions"</span>, <span class="st">"Household is deprived in four dimensions"</span>, <span class="st">"Does not apply"</span>, <span class="st">"Household is not deprived in any dimension"</span>, <span class="st">"Household is deprived in one dimension"</span>, <span class="st">"Household is deprived in two dimensions"</span>, <span class="st">"Household is deprived in three dimensions"</span>, <span class="st">"Household is deprived in four dimensions"</span>)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>deprivation <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">26952</span>, <span class="dv">21374</span>, <span class="dv">12688</span>, <span class="dv">4856</span>, <span class="dv">203</span>, <span class="dv">0</span>, <span class="dv">86264</span>, <span class="dv">67761</span>, <span class="dv">38407</span>, <span class="dv">14386</span>, <span class="dv">673</span>, <span class="dv">0</span>, <span class="dv">35793</span>, <span class="dv">27070</span>, <span class="dv">13852</span>, <span class="dv">4161</span>, <span class="dv">137</span>, <span class="dv">0</span>, <span class="dv">55668</span>, <span class="dv">41850</span>, <span class="dv">19817</span>, <span class="dv">5463</span>, <span class="dv">275</span>, <span class="dv">0</span>, <span class="dv">65530</span>, <span class="dv">47854</span>, <span class="dv">22925</span>, <span class="dv">6645</span>, <span class="dv">298</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now need to put these columns together as a data frame as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(lt_la, deprivation_category, deprivation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can explore its structure:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   30 obs. of  3 variables:
 $ lt_la               : chr  "Knowsley" "Knowsley" "Knowsley" "Knowsley" ...
 $ deprivation_category: chr  "Does not apply" "Household is not deprived in any dimension" "Household is deprived in one dimension" "Household is deprived in two dimensions" ...
 $ deprivation         : num  0 26952 21374 12688 4856 ...</code></pre>
</div>
</div>
<p><strong>Referencing data frames</strong></p>
<p>To refer to particular parts of a data frame - say, a particular column, or a subset of respondents. Hence it is worth spending some time understanding how to reference data frames.</p>
<p>The relevant R function, <code>[ ]</code>, has the format <code>[row,col]</code> or, more generally, <code>[set of rows, set of cols]</code>.</p>
<p>Run the following commands to get a feel of how to extract different slices of the data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>df <span class="co"># whole data.frame</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>df[<span class="dv">1</span>, <span class="dv">1</span>] <span class="co"># contents of first row and column</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>df[<span class="dv">2</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>] <span class="co"># contents of the second row, second and third columns</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>df[<span class="dv">1</span>, ] <span class="co"># first row, ALL columns [the default if no columns specified]</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>df[ ,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="co"># ALL rows; first and second columns</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>df[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>), ] <span class="co"># rows 1,3,5; ALL columns</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>df[ , <span class="dv">2</span>] <span class="co"># ALL rows; second column (by default results containing only </span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>             <span class="co">#one column are converted back into a vector)</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>df[ , <span class="dv">2</span>, drop<span class="ot">=</span><span class="cn">FALSE</span>] <span class="co"># ALL rows; second column (returned as a data.frame)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the above, note that we have used two other R functions:</p>
<p><code>1:3</code> The colon operator tells R to produce a list of numbers including the named start and end points.</p>
<p><code>c(1,3,5)</code> tells R to combine the contents within the brackets into one list of objects.</p>
<p>Run both of these functions on their own to get a better understanding of what they do.</p>
<p>Three other methods for referencing the contents of a data.frame make direct use of the variable names within the data.frame, which tends to make for easier to read/understand code:</p>
<pre><code>df[, "deprivation"] # variable name in quotes inside the square brackets

df$deprivation # variable name prefixed with $ and appended to the data.frame name
# or you can use attach

attach(df)
deprivation # but be careful if you already have an age variable in your local workspace</code></pre>
<p>Want to check the variables available, use the <code>names( )</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "lt_la"                "deprivation_category" "deprivation"         </code></pre>
</div>
</div>
<p><strong>Manipulating data frames</strong></p>
<p><u><em>Adding new columns</em></u></p>
<p>Usually you want to add or create new variables to your data frame using existing variables e.g.&nbsp;computing percentages by dividing two variables. There are many ways in which you can do this i.e.&nbsp;referencing a data frame as we have done above, or using <code>$</code> (e.g.&nbsp;df_census$pop). For this course, we will use tidyverse.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>df_census <span class="ot">&lt;-</span> df_census <span class="sc">%&gt;%</span> </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">active_travel =</span> Method.of.travel.to.workplace..Bicycle <span class="sc">+</span> Method.of.travel.to.workplace..On.foot )</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(df_census)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   35672 obs. of  16 variables:
 $ date                                                                                                                     : int  2021 2021 2021 2021 2021 2021 2021 2021 2021 2021 ...
 $ geography                                                                                                                : chr  "City of London 001A" "City of London 001B" "City of London 001C" "City of London 001E" ...
 $ geography.code                                                                                                           : chr  "E01000001" "E01000002" "E01000003" "E01000005" ...
 $ Method.of.travel.to.workplace..Total..All.usual.residents.aged.16.years.and.over.in.employment.the.week.before.the.census: int  866 881 1000 496 888 1385 651 784 740 904 ...
 $ Method.of.travel.to.workplace..Work.mainly.at.or.from.home                                                               : int  639 676 618 203 192 370 80 163 136 188 ...
 $ Method.of.travel.to.workplace..Underground..metro..light.rail..tram                                                      : int  35 31 74 69 205 358 126 201 155 203 ...
 $ Method.of.travel.to.workplace..Train                                                                                     : int  17 10 21 25 104 177 74 96 88 112 ...
 $ Method.of.travel.to.workplace..Bus..minibus.or.coach                                                                     : int  13 15 26 44 60 117 125 70 86 98 ...
 $ Method.of.travel.to.workplace..Taxi                                                                                      : int  4 2 4 2 1 8 4 1 1 10 ...
 $ Method.of.travel.to.workplace..Motorcycle..scooter.or.moped                                                              : int  3 1 4 3 5 3 3 4 3 5 ...
 $ Method.of.travel.to.workplace..Driving.a.car.or.van                                                                      : int  18 19 24 33 227 220 176 166 174 203 ...
 $ Method.of.travel.to.workplace..Passenger.in.a.car.or.van                                                                 : int  0 3 7 1 10 21 11 19 28 12 ...
 $ Method.of.travel.to.workplace..Bicycle                                                                                   : int  24 25 62 18 6 21 6 5 12 14 ...
 $ Method.of.travel.to.workplace..On.foot                                                                                   : int  109 92 143 90 61 71 40 44 42 38 ...
 $ Method.of.travel.to.workplace..Other.method.of.travel.to.work                                                            : int  4 7 17 8 17 19 6 15 15 21 ...
 $ active_travel                                                                                                            : int  133 117 205 108 67 92 46 49 54 52 ...</code></pre>
</div>
</div>
<p>Note we used a pipe operator <code>%&gt;%</code>. This operator helps make the code more efficient and readable, see <span class="citation" data-cites="wickham2023r">Wickham, Çetinkaya-Rundel, and Grolemund (<a href="references.html#ref-wickham2023r" role="doc-biblioref">2023</a>)</span> for more details. When using the pipe operator, recall to first indicate the data frame before <code>%&gt;%</code>.</p>
<p>Note also the use a variable name before the <code>=</code> sign in brackets to indicate the name of the new variable after mutate.</p>
<p><u><em>Selecting columns</em></u></p>
<p>Usually you want to select a subset of variables for your analysis as storing to large data sets in your R memory can reduce the processing speed of your machine. A selection of data can be achieved by using the <code>select</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>ndf <span class="ot">&lt;-</span> df_census <span class="sc">%&gt;%</span> </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>( geography, active_travel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Again first indicate the data frame and then the variable you want to select to build a new data frame. Note the code chunk above has created a new data frame called <code>ndf</code>. Explore it.</p>
<p><u><em>Filtering data</em></u></p>
<p>You may also want to filter values based on defined conditions. You may want to filter observations greater than a certain threshold or only areas within a certain region. For example, you may want to select areas with an active travel count over 100:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>ndf2 <span class="ot">&lt;-</span> ndf <span class="sc">%&gt;%</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>( active_travel <span class="sc">&gt;</span> <span class="dv">100</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can use more than one variable to set conditions. Use “<code>,</code>” to add a condition.</p>
<p><u><em>Joining data frames</em></u></p>
<p>We often need to join data from separate data frames. To this end, you need a common unique id variable. Let us imagine we have two separate data frames i.e.&nbsp;our original census data frame (<code>df_census</code>) and our data frame containing our active travel counts (i.e.&nbsp;<code>ndf</code>), and we want to join them. We re-read our <code>df_census</code> and then join the data frames.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read data</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>df_census <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./data/census2021-ts061-lsoa.csv"</span>)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="co"># visualise data structure</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(df_census)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   35672 obs. of  15 variables:
 $ date                                                                                                                     : int  2021 2021 2021 2021 2021 2021 2021 2021 2021 2021 ...
 $ geography                                                                                                                : chr  "City of London 001A" "City of London 001B" "City of London 001C" "City of London 001E" ...
 $ geography.code                                                                                                           : chr  "E01000001" "E01000002" "E01000003" "E01000005" ...
 $ Method.of.travel.to.workplace..Total..All.usual.residents.aged.16.years.and.over.in.employment.the.week.before.the.census: int  866 881 1000 496 888 1385 651 784 740 904 ...
 $ Method.of.travel.to.workplace..Work.mainly.at.or.from.home                                                               : int  639 676 618 203 192 370 80 163 136 188 ...
 $ Method.of.travel.to.workplace..Underground..metro..light.rail..tram                                                      : int  35 31 74 69 205 358 126 201 155 203 ...
 $ Method.of.travel.to.workplace..Train                                                                                     : int  17 10 21 25 104 177 74 96 88 112 ...
 $ Method.of.travel.to.workplace..Bus..minibus.or.coach                                                                     : int  13 15 26 44 60 117 125 70 86 98 ...
 $ Method.of.travel.to.workplace..Taxi                                                                                      : int  4 2 4 2 1 8 4 1 1 10 ...
 $ Method.of.travel.to.workplace..Motorcycle..scooter.or.moped                                                              : int  3 1 4 3 5 3 3 4 3 5 ...
 $ Method.of.travel.to.workplace..Driving.a.car.or.van                                                                      : int  18 19 24 33 227 220 176 166 174 203 ...
 $ Method.of.travel.to.workplace..Passenger.in.a.car.or.van                                                                 : int  0 3 7 1 10 21 11 19 28 12 ...
 $ Method.of.travel.to.workplace..Bicycle                                                                                   : int  24 25 62 18 6 21 6 5 12 14 ...
 $ Method.of.travel.to.workplace..On.foot                                                                                   : int  109 92 143 90 61 71 40 44 42 38 ...
 $ Method.of.travel.to.workplace..Other.method.of.travel.to.work                                                            : int  4 7 17 8 17 19 6 15 15 21 ...</code></pre>
</div>
</div>
<p>The variable <code>geography</code> in this data frame corresponds to the unique identifier we will use. As they are unique, they can be automatically matched by using the <code>merge()</code> function. The <code>merge()</code> function uses two arguments: <code>x</code> and <code>y</code>. The former refers to data frame 1 and the latter to data frame 2. Both of these two data frames must have a id variable containing the same information. Note they can have different names. Another key argument to include is <code>all.x=TRUE</code> which tells the function to keep all the records in <code>x</code>, but only those in <code>y</code> that match in case there are discrepancies in the <code>id</code> variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># join data frames</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>join_dfs <span class="ot">&lt;-</span> <span class="fu">merge</span>( df_census, <span class="co"># df1</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>                   ndf, <span class="co"># df2</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">by.x=</span><span class="st">"geography"</span>, <span class="at">by.y=</span><span class="st">"geography"</span>, <span class="co"># common ids</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="co"># check data</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(join_dfs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  geography date geography.code
1 Adur 001A 2021      E01031349
2 Adur 001B 2021      E01031350
3 Adur 001C 2021      E01031351
4 Adur 001D 2021      E01031352
5 Adur 001E 2021      E01031370
6 Adur 001F 2021      E01031374
  Method.of.travel.to.workplace..Total..All.usual.residents.aged.16.years.and.over.in.employment.the.week.before.the.census
1                                                                                                                       665
2                                                                                                                       655
3                                                                                                                       771
4                                                                                                                       685
5                                                                                                                       694
6                                                                                                                       832
  Method.of.travel.to.workplace..Work.mainly.at.or.from.home
1                                                        203
2                                                        170
3                                                        216
4                                                        192
5                                                        191
6                                                        301
  Method.of.travel.to.workplace..Underground..metro..light.rail..tram
1                                                                   0
2                                                                   2
3                                                                   0
4                                                                   0
5                                                                   1
6                                                                   0
  Method.of.travel.to.workplace..Train
1                                   15
2                                   12
3                                   13
4                                    9
5                                    8
6                                   21
  Method.of.travel.to.workplace..Bus..minibus.or.coach
1                                                   20
2                                                   36
3                                                   24
4                                                   31
5                                                   20
6                                                   23
  Method.of.travel.to.workplace..Taxi
1                                   0
2                                   4
3                                   3
4                                   4
5                                   4
6                                   1
  Method.of.travel.to.workplace..Motorcycle..scooter.or.moped
1                                                           7
2                                                           3
3                                                           4
4                                                           6
5                                                           6
6                                                           4
  Method.of.travel.to.workplace..Driving.a.car.or.van
1                                                 326
2                                                 318
3                                                 412
4                                                 351
5                                                 341
6                                                 364
  Method.of.travel.to.workplace..Passenger.in.a.car.or.van
1                                                       23
2                                                       33
3                                                       22
4                                                       25
5                                                       22
6                                                       28
  Method.of.travel.to.workplace..Bicycle Method.of.travel.to.workplace..On.foot
1                                     17                                     48
2                                     18                                     48
3                                     24                                     44
4                                     19                                     41
5                                     25                                     66
6                                     32                                     52
  Method.of.travel.to.workplace..Other.method.of.travel.to.work active_travel
1                                                             6            65
2                                                            11            66
3                                                             9            68
4                                                             7            60
5                                                            10            91
6                                                             6            84</code></pre>
</div>
</div>
<p><u><em>Saving data</em></u></p>
<p>You may need to save your R projects. Projects contain all the objects that you have created in your workspace. You can save them by using the <code>save.image( )</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save.image</span>(<span class="st">"lcr-course_day-1.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This creates a file labelled <code>“lcr-course_day-1.RData”</code> in your working directory. You can load this at a later stage using the <code>load( )</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"lcr-course_day-1.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Alternatively you can save or export your data into a csv file. The first argument in the function is the object name, and the second: the name of the csv we want to create.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(join_dfs, <span class="st">"join_censusdfs.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="geographic-data-frames" class="level3 page-columns page-full" data-number="1.10.2">
<h3 data-number="1.10.2" class="anchored" data-anchor-id="geographic-data-frames"><span class="header-section-number">1.10.2</span> Geographic data frames</h3>
<p>An important component of geographic data science is to manipulate geographic data frames. R has various purposely designed <code>packages</code> for manipulation of spatial data and spatial analysis techniques. Various packages exist in CRAN, including <code>sf</code> <span class="citation" data-cites="sf2018 R-sf">(<a href="references.html#ref-sf2018" role="doc-biblioref">E. Pebesma 2018</a>, <a href="references.html#ref-R-sf" role="doc-biblioref">2022a</a>)</span>, <code>stars</code> <span class="citation" data-cites="R-stars">(<a href="references.html#ref-R-stars" role="doc-biblioref">E. Pebesma 2022b</a>)</span>, <code>terra</code>, <code>s2</code> <span class="citation" data-cites="R-s2">(<a href="references.html#ref-R-s2" role="doc-biblioref">Dunnington, Pebesma, and Rubak 2023</a>)</span>, <code>lwgeom</code> <span class="citation" data-cites="R-lwgeom">(<a href="references.html#ref-R-lwgeom" role="doc-biblioref">E. Pebesma 2023</a>)</span>, <code>gstat</code> <span class="citation" data-cites="pebesma2004 R-gstat">(<a href="references.html#ref-pebesma2004" role="doc-biblioref">E. J. Pebesma 2004</a>; <a href="references.html#ref-R-gstat" role="doc-biblioref">E. Pebesma and Graeler 2022</a>)</span>, <code>spdep</code> <span class="citation" data-cites="R-spdep">(<a href="references.html#ref-R-spdep" role="doc-biblioref">Bivand 2022</a>)</span>, <code>spatialreg</code> <span class="citation" data-cites="R-spatialreg">(<a href="references.html#ref-R-spatialreg" role="doc-biblioref">Bivand and Piras 2022</a>)</span>, <code>spatstat</code> <span class="citation" data-cites="baddeley2015spatial R-spatstat">(<a href="references.html#ref-baddeley2015spatial" role="doc-biblioref">Baddeley, Rubak, and Turner 2015</a>; <a href="references.html#ref-R-spatstat" role="doc-biblioref">Baddeley, Turner, and Rubak 2022</a>)</span>, <code>tmap</code> <span class="citation" data-cites="tmap2018 R-tmap">(<a href="references.html#ref-tmap2018" role="doc-biblioref">Tennekes 2018</a>, <a href="references.html#ref-R-tmap" role="doc-biblioref">2022</a>)</span>, <code>mapview</code> <span class="citation" data-cites="R-mapview">(<a href="references.html#ref-R-mapview" role="doc-biblioref">Appelhans et al. 2022</a>)</span> and more. A key package is this ecosystem is <code>sf</code> <span class="citation" data-cites="pebesma2023spatial">(<a href="references.html#ref-pebesma2023spatial" role="doc-biblioref">E. Pebesma and Bivand 2023</a>)</span>. R package <code>sf</code> provides a table format for simple features, where feature geometries are stored in a list-column. It appeared in 2016 and was developed to move spatial data analysis in R closer to standards-based approaches seen in the industry and open source projects, to build upon more modern versions of open source geospatial software stack and allow for integration of R spatial software with the <code>tidyverse</code> <span class="citation" data-cites="tidyverse2019">(<a href="references.html#ref-tidyverse2019" role="doc-biblioref">Wickham et al. 2019</a>)</span>, particularly <code>ggplot2</code>, <code>dplyr</code>, and <code>tidyr</code>. Hence, this book relies heavely on <code>sf</code> for the manipulation and analysis of the data.</p>

<div class="no-row-height column-margin column-container"><div class="">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><span class="citation" data-cites="lovelace2024">Lovelace, Nowosad, and Muenchow (<a href="references.html#ref-lovelace2024" role="doc-biblioref">2024</a>)</span> provide a helpful overview and evolution of R spatial package ecosystem.</p>
</div>
</div>
</div></div><p><strong>Reading geographic data frames</strong></p>
<p>To read our spatial data, we use the st_read function. We read a shapefile containing data at the Lower Super Output Areas (LSOAs) level.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>sdf <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"./data/LCR-LSOA.gpkg"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `LCR-LSOA' from data source 
  `/Users/franciscorowe/Dropbox/Francisco/Research/grants/2024/lcr_training/lcr-training/data/LCR-LSOA.gpkg' 
  using driver `GPKG'
Simple feature collection with 1043 features and 7 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 318351.7 ymin: 377513.8 xmax: 361791.1 ymax: 422866.5
Projected CRS: OSGB36 / British National Grid</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sdf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 7 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 356526.1 ymin: 397294.1 xmax: 359746.3 ymax: 399734.2
Projected CRS: OSGB36 / British National Grid
   LSOA21CD   LSOA21NM                               GlobalID Rank. Decile
1 E01006220 Wigan 035A {6A968831-6B5B-42A7-AFDE-9A2FD2E01FE2}     5      5
2 E01006225 Wigan 036B {0727B328-8FBD-4074-A887-A40CB89502E2}     9      9
3 E01006226 Wigan 035E {8A587355-7518-47EF-A60A-6CB117F54F05}     8      8
4 E01006227 Wigan 038A {CC387BCB-5B3B-4E57-ABA3-4ADB3175D624}     8      8
5 E01006264 Wigan 036D {89C9660D-5EC9-4498-BEBF-BED018377F41}    10     10
6 E01006346 Wigan 038E {37DD7E6B-F345-400F-BD76-D8700BFCE534}     7      7
       Top  Bottom.                           geom
1 17.47911 42.96657 MULTIPOLYGON (((359223.5 39...
2 39.40579 27.52150 MULTIPOLYGON (((356696.7 39...
3 29.37013 36.02265 MULTIPOLYGON (((358079.4 39...
4 27.95950 37.14953 MULTIPOLYGON (((359464.4 39...
5 38.51224 26.55367 MULTIPOLYGON (((356526.2 39...
6 28.96305 36.88915 MULTIPOLYGON (((359465.7 39...</code></pre>
</div>
</div>
<p>Examine the input data. A spatial data frame stores a range of attributes derived from a shapefile including the geometry of features (e.g.&nbsp;polygon shape and location), attributes for each feature (stored in the .dbf), projection and coordinates of the shapefile’s bounding box - for details, execute:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>?st_read</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can employ the usual functions to visualise the content of the created data frame:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># visualise variable names</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(sdf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "LSOA21CD" "LSOA21NM" "GlobalID" "Rank."    "Decile"   "Top"      "Bottom." 
[8] "geom"    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># data structure</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(sdf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Classes 'sf' and 'data.frame':  1043 obs. of  8 variables:
 $ LSOA21CD: chr  "E01006220" "E01006225" "E01006226" "E01006227" ...
 $ LSOA21NM: chr  "Wigan 035A" "Wigan 036B" "Wigan 035E" "Wigan 038A" ...
 $ GlobalID: chr  "{6A968831-6B5B-42A7-AFDE-9A2FD2E01FE2}" "{0727B328-8FBD-4074-A887-A40CB89502E2}" "{8A587355-7518-47EF-A60A-6CB117F54F05}" "{CC387BCB-5B3B-4E57-ABA3-4ADB3175D624}" ...
 $ Rank.   : num  5 9 8 8 10 7 10 7 9 1 ...
 $ Decile  : int  5 9 8 8 10 7 10 7 9 1 ...
 $ Top     : num  17.5 39.4 29.4 28 38.5 ...
 $ Bottom. : num  43 27.5 36 37.1 26.6 ...
 $ geom    :sfc_MULTIPOLYGON of length 1043; first list element: List of 3
  ..$ :List of 1
  .. ..$ : num [1:17, 1:2] 359223 359312 359308 359300 359297 ...
  ..$ :List of 1
  .. ..$ : num [1:4, 1:2] 359352 359347 359346 359352 398448 ...
  ..$ :List of 1
  .. ..$ : num [1:12, 1:2] 359474 359467 359461 359462 359464 ...
  ..- attr(*, "class")= chr [1:3] "XY" "MULTIPOLYGON" "sfg"
 - attr(*, "sf_column")= chr "geom"
 - attr(*, "agr")= Factor w/ 3 levels "constant","aggregate",..: NA NA NA NA NA NA NA
  ..- attr(*, "names")= chr [1:7] "LSOA21CD" "LSOA21NM" "GlobalID" "Rank." ...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># see first few observations</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sdf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 7 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 356526.1 ymin: 397294.1 xmax: 359746.3 ymax: 399734.2
Projected CRS: OSGB36 / British National Grid
   LSOA21CD   LSOA21NM                               GlobalID Rank. Decile
1 E01006220 Wigan 035A {6A968831-6B5B-42A7-AFDE-9A2FD2E01FE2}     5      5
2 E01006225 Wigan 036B {0727B328-8FBD-4074-A887-A40CB89502E2}     9      9
3 E01006226 Wigan 035E {8A587355-7518-47EF-A60A-6CB117F54F05}     8      8
4 E01006227 Wigan 038A {CC387BCB-5B3B-4E57-ABA3-4ADB3175D624}     8      8
5 E01006264 Wigan 036D {89C9660D-5EC9-4498-BEBF-BED018377F41}    10     10
6 E01006346 Wigan 038E {37DD7E6B-F345-400F-BD76-D8700BFCE534}     7      7
       Top  Bottom.                           geom
1 17.47911 42.96657 MULTIPOLYGON (((359223.5 39...
2 39.40579 27.52150 MULTIPOLYGON (((356696.7 39...
3 29.37013 36.02265 MULTIPOLYGON (((358079.4 39...
4 27.95950 37.14953 MULTIPOLYGON (((359464.4 39...
5 38.51224 26.55367 MULTIPOLYGON (((356526.2 39...
6 28.96305 36.88915 MULTIPOLYGON (((359465.7 39...</code></pre>
</div>
</div>
<p><strong>Manipulating geographic data frames</strong></p>
<p>As indicated above, the advantage of using <code>sf</code> to handle spatial data frames is that you can deploy all the tidyverse ecosystem. For example, try the tasks below.</p>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Task</strong></p>
<p>Try selecting columns “LSOA21NM” and “Decile” and using the new data frame to filter the data by “Decile = 5”.</p>
</div>
</div>
</div>
<p><u><em>Simplifying boundaries</em></u></p>
<p>Normally, the resolution of boundaries is very detailed and precise, but such level of detail and precision is not necessary for visualisation purposes, making their rendering small and computationally intensive. To address this, we simplify the boundaries which means we make them less detailed and precise. We can achive this as follows”</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># simplify boundaries</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>simple_sdf <span class="ot">&lt;-</span> sdf <span class="sc">%&gt;%</span> </span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_simplify</span>(<span class="at">preserveTopology =</span>T, </span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">dTolerance =</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span>  <span class="co"># 100m</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_make_valid</span>() <span class="co"># check the geometry is valid</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>simple_sdf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 1043 features and 7 fields
Geometry type: GEOMETRY
Dimension:     XY
Bounding box:  xmin: 318370.4 ymin: 377513.8 xmax: 361791.1 ymax: 422852
Projected CRS: OSGB36 / British National Grid
First 10 features:
    LSOA21CD      LSOA21NM                               GlobalID Rank. Decile
1  E01006220    Wigan 035A {6A968831-6B5B-42A7-AFDE-9A2FD2E01FE2}     5      5
2  E01006225    Wigan 036B {0727B328-8FBD-4074-A887-A40CB89502E2}     9      9
3  E01006226    Wigan 035E {8A587355-7518-47EF-A60A-6CB117F54F05}     8      8
4  E01006227    Wigan 038A {CC387BCB-5B3B-4E57-ABA3-4ADB3175D624}     8      8
5  E01006264    Wigan 036D {89C9660D-5EC9-4498-BEBF-BED018377F41}    10     10
6  E01006346    Wigan 038E {37DD7E6B-F345-400F-BD76-D8700BFCE534}     7      7
7  E01006348    Wigan 039E {A24ED8C9-78AC-4C8C-8E32-45135C82072B}    10     10
8  E01006366    Wigan 018E {3CF75243-6530-41F4-81F5-12B8F9C9FD73}     7      7
9  E01006368    Wigan 018G {02EA8DCD-7F22-4B80-A9D2-C16E346F6AB4}     9      9
10 E01006412 Knowsley 006A {F20DE2BD-17F4-4CAC-B81D-DDCD2335AD32}     1      1
        Top  Bottom.                           geom
1  17.47911 42.96657 MULTIPOLYGON (((359466.9 39...
2  39.40579 27.52150 MULTIPOLYGON (((357307.6 39...
3  29.37013 36.02265 MULTIPOLYGON (((358079.4 39...
4  27.95950 37.14953 MULTIPOLYGON (((359464.7 39...
5  38.51224 26.55367 MULTIPOLYGON (((356600.3 39...
6  28.96305 36.88915 MULTIPOLYGON (((359555.1 39...
7  45.76905 19.96260 MULTIPOLYGON (((359656.1 39...
8  35.56405 29.57298 MULTIPOLYGON (((352147.5 40...
9  35.92737 26.32944 MULTIPOLYGON (((353739.3 40...
10 11.05569 42.80964 POLYGON ((342810.5 394193.3...</code></pre>
</div>
</div>
<p><u><em>Reprojecting boundaries</em></u></p>
<p>We often work with multiple shapefiles in one project and these shapefiles can have boundaries in different projections. As such, they need to be harmonised before they can be integrated in analysis. We show how this process can be conducted.</p>
<p>The first step is to decide the Coordinate Reference Systems (CRS) for the data to be projected. In this example, we use the World Geodetic System 1984 (i.e.&nbsp;EPSG:4326).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set crs</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>crs_default <span class="ot">=</span> <span class="st">"EPSG:4326"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># change crs</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>repro_simple_sdf <span class="ot">&lt;-</span> simple_sdf <span class="sc">%&gt;%</span> </span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(crs_default) </span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>repro_simple_sdf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 1043 features and 7 fields
Geometry type: GEOMETRY
Dimension:     XY
Bounding box:  xmin: -3.22874 ymin: 53.28929 xmax: -2.576743 ymax: 53.69821
Geodetic CRS:  WGS 84
First 10 features:
    LSOA21CD      LSOA21NM                               GlobalID Rank. Decile
1  E01006220    Wigan 035A {6A968831-6B5B-42A7-AFDE-9A2FD2E01FE2}     5      5
2  E01006225    Wigan 036B {0727B328-8FBD-4074-A887-A40CB89502E2}     9      9
3  E01006226    Wigan 035E {8A587355-7518-47EF-A60A-6CB117F54F05}     8      8
4  E01006227    Wigan 038A {CC387BCB-5B3B-4E57-ABA3-4ADB3175D624}     8      8
5  E01006264    Wigan 036D {89C9660D-5EC9-4498-BEBF-BED018377F41}    10     10
6  E01006346    Wigan 038E {37DD7E6B-F345-400F-BD76-D8700BFCE534}     7      7
7  E01006348    Wigan 039E {A24ED8C9-78AC-4C8C-8E32-45135C82072B}    10     10
8  E01006366    Wigan 018E {3CF75243-6530-41F4-81F5-12B8F9C9FD73}     7      7
9  E01006368    Wigan 018G {02EA8DCD-7F22-4B80-A9D2-C16E346F6AB4}     9      9
10 E01006412 Knowsley 006A {F20DE2BD-17F4-4CAC-B81D-DDCD2335AD32}     1      1
        Top  Bottom.                           geom
1  17.47911 42.96657 MULTIPOLYGON (((-2.612213 5...
2  39.40579 27.52150 MULTIPOLYGON (((-2.644766 5...
3  29.37013 36.02265 MULTIPOLYGON (((-2.633147 5...
4  27.95950 37.14953 MULTIPOLYGON (((-2.612225 5...
5  38.51224 26.55367 MULTIPOLYGON (((-2.655565 5...
6  28.96305 36.88915 MULTIPOLYGON (((-2.610809 5...
7  45.76905 19.96260 MULTIPOLYGON (((-2.609102 5...
8  35.56405 29.57298 MULTIPOLYGON (((-2.723027 5...
9  35.92737 26.32944 MULTIPOLYGON (((-2.698892 5...
10 11.05569 42.80964 POLYGON ((-2.862428 53.4413...</code></pre>
</div>
</div>
<p><u><em>Mapping</em></u></p>
<p>We can also quickly map spatial boundaries by using the R base function <code>plot</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(simple_sdf<span class="sc">$</span>geom)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="01_fundamentals_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>During the next session, we will explore more sophisticated ways of mapping spatial data using different packages and functions.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-R-mapview" class="csl-entry" role="listitem">
Appelhans, Tim, Florian Detsch, Christoph Reudenbach, and Stefan Woellauer. 2022. <em>Mapview: Interactive Viewing of Spatial Data in r</em>. <a href="https://github.com/r-spatial/mapview">https://github.com/r-spatial/mapview</a>.
</div>
<div id="ref-baddeley2015spatial" class="csl-entry" role="listitem">
Baddeley, Adrian, Ege Rubak, and Rolf Turner. 2015. <em>Spatial Point Patterns: Methodology and Applications with r</em>. CRC press.
</div>
<div id="ref-R-spatstat" class="csl-entry" role="listitem">
Baddeley, Adrian, Rolf Turner, and Ege Rubak. 2022. <em>Spatstat: Spatial Point Pattern Analysis, Model-Fitting, Simulation, Tests</em>. <a href="http://spatstat.org/">http://spatstat.org/</a>.
</div>
<div id="ref-R-spdep" class="csl-entry" role="listitem">
Bivand, Roger. 2022. <em>Spdep: Spatial Dependence: Weighting Schemes, Statistics</em>.
</div>
<div id="ref-R-spatialreg" class="csl-entry" role="listitem">
Bivand, Roger, and Gianfranco Piras. 2022. <em>Spatialreg: Spatial Regression Analysis</em>. <a href="https://CRAN.R-project.org/package=spatialreg">https://CRAN.R-project.org/package=spatialreg</a>.
</div>
<div id="ref-R-s2" class="csl-entry" role="listitem">
Dunnington, Dewey, Edzer Pebesma, and Ege Rubak. 2023. <em>S2: Spherical Geometry Operators Using the S2 Geometry Library</em>. <a href="https://CRAN.R-project.org/package=s2">https://CRAN.R-project.org/package=s2</a>.
</div>
<div id="ref-lovelace2024" class="csl-entry" role="listitem">
Lovelace, Robin, Jakub Nowosad, and Jannes Muenchow. 2024. <em>Geocomputation with r</em>. Online. <a href="https://doi.org/10.1201/9780203730058">https://doi.org/10.1201/9780203730058</a>.
</div>
<div id="ref-sf2018" class="csl-entry" role="listitem">
Pebesma, Edzer. 2018. <span>“<span class="nocase">Simple Features for R: Standardized Support for Spatial Vector Data</span>.”</span> <em><span>The R Journal</span></em> 10 (1): 439–46. <a href="https://doi.org/10.32614/RJ-2018-009">https://doi.org/10.32614/RJ-2018-009</a>.
</div>
<div id="ref-R-sf" class="csl-entry" role="listitem">
———. 2022a. <em>Sf: Simple Features for r</em>. <a href="https://CRAN.R-project.org/package=sf">https://CRAN.R-project.org/package=sf</a>.
</div>
<div id="ref-R-stars" class="csl-entry" role="listitem">
———. 2022b. <em>Stars: Spatiotemporal Arrays, Raster and Vector Data Cubes</em>. <a href="https://CRAN.R-project.org/package=stars">https://CRAN.R-project.org/package=stars</a>.
</div>
<div id="ref-R-lwgeom" class="csl-entry" role="listitem">
———. 2023. <em>Lwgeom: Bindings to Selected Liblwgeom Functions for Simple Features</em>. <a href="https://github.com/r-spatial/lwgeom/">https://github.com/r-spatial/lwgeom/</a>.
</div>
<div id="ref-pebesma2004" class="csl-entry" role="listitem">
Pebesma, Edzer J. 2004. <span>“Multivariable Geostatistics in S: The Gstat Package.”</span> <em>Computers &amp; Geosciences</em> 30 (7): 683–91. <a href="https://doi.org/10.1016/j.cageo.2004.03.012">https://doi.org/10.1016/j.cageo.2004.03.012</a>.
</div>
<div id="ref-pebesma2023spatial" class="csl-entry" role="listitem">
Pebesma, Edzer, and Roger Bivand. 2023. <em>Spatial Data Science: With Applications in r</em>. CRC Press.
</div>
<div id="ref-R-gstat" class="csl-entry" role="listitem">
Pebesma, Edzer, and Benedikt Graeler. 2022. <em>Gstat: Spatial and Spatio-Temporal Geostatistical Modelling, Prediction and Simulation</em>. <a href="https://github.com/r-spatial/gstat/">https://github.com/r-spatial/gstat/</a>.
</div>
<div id="ref-tmap2018" class="csl-entry" role="listitem">
Tennekes, Martijn. 2018. <span>“<span class="nocase">tmap</span>: Thematic Maps in <span>R</span>.”</span> <em>Journal of Statistical Software</em> 84 (6): 1–39. <a href="https://doi.org/10.18637/jss.v084.i06">https://doi.org/10.18637/jss.v084.i06</a>.
</div>
<div id="ref-R-tmap" class="csl-entry" role="listitem">
———. 2022. <em>Tmap: Thematic Maps</em>. <a href="https://github.com/r-tmap/tmap">https://github.com/r-tmap/tmap</a>.
</div>
<div id="ref-tidyverse2019" class="csl-entry" role="listitem">
Wickham, Hadley, Mara Averick, Jennifer Bryan, Winston Chang, Lucy D’Agostino McGowan, Romain François, Garrett Grolemund, et al. 2019. <span>“Welcome to the <span class="nocase">tidyverse</span>.”</span> <em>Journal of Open Source Software</em> 4 (43): 1686. <a href="https://doi.org/10.21105/joss.01686">https://doi.org/10.21105/joss.01686</a>.
</div>
<div id="ref-wickham2023r" class="csl-entry" role="listitem">
Wickham, Hadley, Mine Çetinkaya-Rundel, and Garrett Grolemund. 2023. <em>R for Data Science</em>. " O’Reilly Media, Inc.".
</div>
<div id="ref-xie2018" class="csl-entry" role="listitem">
Xie, Yihui, J. J. Allaire, and Garrett Grolemund. 2018. <em>R Markdown</em>. Chapman; Hall/CRC. <a href="https://doi.org/10.1201/9781138359444">https://doi.org/10.1201/9781138359444</a>.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./00_overview.html" class="pagination-link  aria-label=" overview"="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Overview</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./02_data-visualisation.html" class="pagination-link" aria-label="<span class='chapter-number'>2</span>&nbsp; <span class='chapter-title'>Data Visualisation</span>">
        <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data Visualisation</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>