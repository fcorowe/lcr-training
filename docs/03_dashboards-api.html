<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.189">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>dashboards-api</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="03_dashboards-api_files/libs/clipboard/clipboard.min.js"></script>
<script src="03_dashboards-api_files/libs/quarto-html/quarto.js"></script>
<script src="03_dashboards-api_files/libs/quarto-html/popper.min.js"></script>
<script src="03_dashboards-api_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="03_dashboards-api_files/libs/quarto-html/anchor.min.js"></script>
<link href="03_dashboards-api_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="03_dashboards-api_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="03_dashboards-api_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="03_dashboards-api_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="03_dashboards-api_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">



<section id="dashboards-and-apis" class="level1">
<h1>Dashboards and APIs</h1>
<section id="learning-objectives" class="level2">
<h2 class="anchored" data-anchor-id="learning-objectives">Learning Objectives</h2>
<p>By the end of today’s session you should be able to:</p>
<ol type="1">
<li>Understand the basic principles of APIs</li>
<li>Download and visualise data from NOMIS using the NOMIS API</li>
<li>Understand the basic principles of flexdashboard</li>
<li>Build a basic dashboard using flexdashboard</li>
</ol>
</section>
<section id="introduction-to-apis" class="level2">
<h2 class="anchored" data-anchor-id="introduction-to-apis">Introduction to APIs</h2>
<p>Web services make their data easily accessible to computer programs like R through use of an Application Programming Interface (API). Today’s practical will teach you how to access data from APIs, and load them into your R environment for analysis.</p>
<p>To download data from an API you need to send a HTTP request to a server, which tells the server to return the specific parcel of data that matches the criteria in the HTTP request.</p>
<p>For example, on NOMIS there is a page called <a href="https://www.nomisweb.co.uk/sources/census_2021_bulk">‘Census 2021 Bulk Data Download’</a>, which contains .zip files for different tables of data available from the latest census.</p>
<p>Now you should go to the <a href="https://www.nomisweb.co.uk/sources/census_2021_bulk">‘Census 2021 Bulk Data Download’</a> page, and see what it contains.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/04/nomis.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">NOMIS</figcaption><p></p>
</figure>
</div>
<p>There are lots of files on the web page - e.g.&nbsp;<code>census2021-ts001.zip</code>, <code>census2021-ts007a.zip</code>.</p>
<p>You can click on these files individually, download them to your PC, unzip them and read them into R. Alternatively, we can programmatically download the data directly from the webpage. If you ‘right click’ on one of the .zip files and press ‘copy link’, you will have a URL which can access that specific .zip file, as below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">"https://www.nomisweb.co.uk/output/census/2021/census2021-ts061.zip"</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>url</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "https://www.nomisweb.co.uk/output/census/2021/census2021-ts061.zip"</code></pre>
</div>
</div>
<p>The specific URL above relates to table <a href="https://www.ons.gov.uk/employmentandlabourmarket/peopleinwork/employmentandemployeetypes/bulletins/traveltoworkenglandandwales/census2021">TS061 - “Method of Travel to Work”</a>, which is the same dataset we have been using throughout this course.</p>
<p>Now I’m going to show you how to download the .zip file, and read in the file of data we used yesterday. This is a really basic example of using an API, which shows how you can download data from NOMIS into your environment, without having to physically go and download it, save it to a folder, unzip it and read it into memory.</p>
<p>First, let’s download the .zip file - this line of code downloads the .zip file to your local machine. It creates a new file in your working directory called ‘temp.zip’ - go and take a look!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Download the .zip file, using the url set above</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(url, <span class="st">"temp.zip"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next we need to unzip the folder, to get to the datasets stored within:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="do">## First set where you want the unzipped files to be stored</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>outDir <span class="ot">&lt;-</span> <span class="st">"data/unzip"</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Unzip the folder to the data/unzip folder</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span>(<span class="st">"temp.zip"</span>, <span class="at">exdir =</span> outDir)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ok so now that you’ve downloaded the files to your local machine, we can look and see what files are available to us:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Use list.files() to see what we unzipped</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">list.files</span>(<span class="st">"data/unzip"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "census2021-ts061-ctry.csv" "census2021-ts061-lsoa.csv"
[3] "census2021-ts061-ltla.csv" "census2021-ts061-msoa.csv"
[5] "census2021-ts061-oa.csv"   "census2021-ts061-rgn.csv" 
[7] "census2021-ts061-utla.csv" "metadata"                 </code></pre>
</div>
</div>
<p>Thankfully, NOMIS use a really standard naming protocol for their files, which makes it really easy to tell what each of the files contains. If you cast your mind back to yesterday, we used a file called “census2021-ts061-lsoa.csv”, which we provided to you as part of the course materials. However, as you can see from the code above, you have now programmatically downloaded the same file, which we can read in:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Read in the LSOA census data</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>db <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/unzip/census2021-ts061-lsoa.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="independent-exercise---over-to-you-15---20-mins" class="level3">
<h3 class="anchored" data-anchor-id="independent-exercise---over-to-you-15---20-mins">Independent exercise - Over to you! (15 - 20 mins)</h3>
<ol type="1">
<li>As a recap, see if you can reproduce one of the visualisations we produced yesterday using the data we have just scraped from the API.</li>
<li>Test downloading two more datasets from NOMIS, by swapping in new URLs, and reading in one of the files from the folder you download.</li>
<li>(<em>optional</em>) Produce an interesting visualisation from that new dataset.</li>
</ol>
<p><strong>Solution 2</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Set the new URL</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>url2 <span class="ot">&lt;-</span> <span class="st">"https://www.nomisweb.co.uk/output/census/2021/census2021-ts066.zip"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Download the files</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(url2, <span class="st">"temp2.zip"</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Unzip the files</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>outDir2 <span class="ot">&lt;-</span> <span class="st">"data/unzip2"</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Unzip the folder to the data/unzip folder</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span>(<span class="st">"temp2.zip"</span>, <span class="at">exdir =</span> outDir2)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Read in the LSOA census data</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>db2 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/unzip2/census2021-ts066-lsoa.csv"</span>)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="do">## Select some columns to work with, and calculate % student</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>db2_clean <span class="ot">&lt;-</span> db2 <span class="sc">%&gt;%</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(geography.code, Economic.activity.status..Total..All.usual.residents.aged.<span class="fl">16.</span>years.and.over, Economic.activity.status..Economically.inactive..Student) <span class="sc">%&gt;%</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"LSOA21CD"</span>, <span class="st">"total"</span>, <span class="st">"student"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">student =</span> (student <span class="sc">/</span> total) <span class="sc">*</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Solution 3</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Produce a histogram</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> db2_clean, <span class="fu">aes</span>(<span class="at">x =</span> student)) <span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">"orange"</span>) <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Population who are students (%)"</span>, <span class="at">y =</span> <span class="st">"Number of LSOAs"</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Data: UK Census (2021) - 'Economic Activity Status' (ts066)"</span>) <span class="sc">+</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="03_dashboards-api_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>So what have we achieved?</p>
<ol type="1">
<li>You can now programmatically download datasets from the NOMIS bulk census page, without needing to download the files.</li>
<li>You can produce visualisations using these different datasets.</li>
<li>You are in a position to automate download and visualisation of census data from NOMIS.</li>
</ol>
</section>
<section id="advanced-bulk-downloading" class="level3">
<h3 class="anchored" data-anchor-id="advanced-bulk-downloading">Advanced Bulk Downloading</h3>
<p>But what if you want to automate this download in a much quicker manner. The NOMIS API is a good way of doing this (and we’ll be discussing this shortly), but the other way you can do this is through the use of functions.</p>
<p>Functions are “self contained modules of code that accomplish a specific task”. They normally take data in soem form, perform a number of modifications to it, and then return some form of result.</p>
<p>The basic syntax of a function is as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Specify a new function</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>function1 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are three important things to notice here:</p>
<ol type="1">
<li>Function name (e.g., <code>function1</code>) - enables you to call the function at a later point.</li>
<li>Object (e.g., <code>function(x)</code>) - is the input data or parameter that you are going to be using.</li>
<li>Steps (e.g., <code>{}</code>) - anything within the curly brackets will be a series of steps that are applied.</li>
</ol>
<p>So a basic example is we can ask the function to return the first five rows of x:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Specify a new function - first five</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>firstfive <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(x)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now you need to run the function on an object - let’s do it on our census dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Apply the function</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">firstfive</span>(db)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  date                 geography geography.code
1 2021       City of London 001A      E01000001
2 2021       City of London 001B      E01000002
3 2021       City of London 001C      E01000003
4 2021       City of London 001E      E01000005
5 2021 Barking and Dagenham 016A      E01000006
6 2021 Barking and Dagenham 015A      E01000007
  Method.of.travel.to.workplace..Total..All.usual.residents.aged.16.years.and.over.in.employment.the.week.before.the.census
1                                                                                                                       866
2                                                                                                                       881
3                                                                                                                      1000
4                                                                                                                       496
5                                                                                                                       888
6                                                                                                                      1385
  Method.of.travel.to.workplace..Work.mainly.at.or.from.home
1                                                        639
2                                                        676
3                                                        618
4                                                        203
5                                                        192
6                                                        370
  Method.of.travel.to.workplace..Underground..metro..light.rail..tram
1                                                                  35
2                                                                  31
3                                                                  74
4                                                                  69
5                                                                 205
6                                                                 358
  Method.of.travel.to.workplace..Train
1                                   17
2                                   10
3                                   21
4                                   25
5                                  104
6                                  177
  Method.of.travel.to.workplace..Bus..minibus.or.coach
1                                                   13
2                                                   15
3                                                   26
4                                                   44
5                                                   60
6                                                  117
  Method.of.travel.to.workplace..Taxi
1                                   4
2                                   2
3                                   4
4                                   2
5                                   1
6                                   8
  Method.of.travel.to.workplace..Motorcycle..scooter.or.moped
1                                                           3
2                                                           1
3                                                           4
4                                                           3
5                                                           5
6                                                           3
  Method.of.travel.to.workplace..Driving.a.car.or.van
1                                                  18
2                                                  19
3                                                  24
4                                                  33
5                                                 227
6                                                 220
  Method.of.travel.to.workplace..Passenger.in.a.car.or.van
1                                                        0
2                                                        3
3                                                        7
4                                                        1
5                                                       10
6                                                       21
  Method.of.travel.to.workplace..Bicycle Method.of.travel.to.workplace..On.foot
1                                     24                                    109
2                                     25                                     92
3                                     62                                    143
4                                     18                                     90
5                                      6                                     61
6                                     21                                     71
  Method.of.travel.to.workplace..Other.method.of.travel.to.work
1                                                             4
2                                                             7
3                                                            17
4                                                             8
5                                                            17
6                                                            19</code></pre>
</div>
</div>
<p>So, that’s a <em>really</em> basic example of how to use a function.</p>
<p>Let me show you how functions can be used to clean datasets programmatically:</p>
<div class="cell">

</div>
<p>However, there is one easier way of getting the data from NOMIS, and this involves use of the NOMIS API.</p>
</section>
</section>
<section id="using-the-nomis-api" class="level2">
<h2 class="anchored" data-anchor-id="using-the-nomis-api">Using the NOMIS API</h2>
<p>One of the things that you see more commonly in practice is the construction of specific R packages used to access APIs, with supporting documentation and specific functions that make it easier to use the API.</p>
<p>One such example is <a href="https://docs.evanodell.com/nomisr/articles/introduction.html">nomisr</a>, which is an R package that was built to enable users to query data from NOMIS. It is free to access and contains up-to-date official statistics including data from the latest Census, Labour Force Survey and DWP benefit statistics.</p>
<p>In the section that follows, I’m going to be showing you how to use the nomisr package to download datasets.</p>
<p>Vast amounts of data are available through NOMIS, so you need to use some of the different functions within nomisr to identify the specific datasets you want to use. An example is presented below which searches for datasets within NOMIS that are specifically about ‘Travel’:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Search for data on Labour Force</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>search <span class="ot">&lt;-</span> <span class="fu">nomis_search</span>(<span class="st">"*Travel*"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This returns a dataframe (which you should see in your environment) that describes all of the different NOMIS held datasets where ‘Travel’ is mentioned. The column perhaps of most interest is the short name for the different datasets, which you can inspect below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Have a look at the first six datasets </span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(search<span class="sc">$</span>name.value)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2001 census - UK travel flows (local authority)"            
[2] "2001 census - Scottish travel flows (local authority)"      
[3] "2001 census - UK travel flows (ward)"                       
[4] "QS702EW - Distance travelled to work"                       
[5] "WD702EW - Distance travelled to work (Workday population)"  
[6] "WP702EW - Distance travelled to work (Workplace population)"</code></pre>
</div>
</div>
<p>If you open up the dataframe in your environment and scroll down you should see one row has the value - TS061 - Method used to travel to work - which is the one we’ve been using a lot in this practical.</p>
<p>We can filter to this row very easily using the filter() command that we introduced yesterday:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Filter to row of interest</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>search_sub <span class="ot">&lt;-</span> search <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name.value <span class="sc">==</span> <span class="st">"TS061 - Method used to travel to work"</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Have a look at the result</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>search_sub</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 12
  agencyid id      uri   version annot…¹ compo…² compo…³ compo…⁴ compo…⁵ compo…⁶
  &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;   &lt;dbl&gt; &lt;list&gt;  &lt;list&gt;  &lt;list&gt;  &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
1 NOMIS    NM_207… Nm-2…       1 &lt;df&gt;    &lt;df&gt;    &lt;df&gt;    OBS_VA… CL_207… TIME   
# … with 2 more variables: name.value &lt;chr&gt;, name.lang &lt;chr&gt;, and abbreviated
#   variable names ¹​annotations.annotation, ²​components.attribute,
#   ³​components.dimension, ⁴​components.primarymeasure.conceptref,
#   ⁵​components.timedimension.codelist, ⁶​components.timedimension.conceptref</code></pre>
</div>
</div>
<p>Notice how the table ID is <code>NM_2078_1</code>.</p>
<p>We can get some metadata for this dataset very easily using the nomis_get_metadata() command. First, let’s see what measures are available:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Supply the ID of the row we're interested in, and the second parameters specifies we'd like to know more about the measures</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nomis_get_metadata</span>(search_sub<span class="sc">$</span>id, <span class="st">"measures"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  id    label.en description.en
  &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;         
1 20100 value    value         
2 20301 percent  percent       </code></pre>
</div>
</div>
<p>So for TS061, we can get both raw counts (‘value’) and percent. Notice how the ID for counts is <code>20100</code> and the ID for percent is <code>20301</code>. Let’s now see what geographies are available:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Supply the ID of the row we're interested in, and the second parameter specifies that we want to know more about geographies</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nomis_get_metadata</span>(search_sub<span class="sc">$</span>id, <span class="st">"geography"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  id         parentCode label.en          description.en   
  &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;             &lt;chr&gt;            
1 2092957703 &lt;NA&gt;       England and Wales England and Wales
2 2092957699 &lt;NA&gt;       England           England          
3 2092957700 2092957700 Wales             Wales            </code></pre>
</div>
</div>
<p>Ok, so this is telling us the different geographic levels we can download the data for. However, if we add an additional parameter to this, we can also see the specific geographic units that this data is available at:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Add in an additional parameter</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nomis_get_metadata</span>(search_sub<span class="sc">$</span>id, <span class="st">"geography"</span>, <span class="st">"TYPE"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 3
   id      label.en                                                 descriptio…¹
   &lt;chr&gt;   &lt;chr&gt;                                                    &lt;chr&gt;       
 1 TYPE150 2021 output areas                                        2021 output…
 2 TYPE151 2021 super output areas - lower layer                    2021 super …
 3 TYPE152 2021 super output areas - middle layer                   2021 super …
 4 TYPE153 2022 wards                                               2022 wards  
 5 TYPE154 2022 local authorities: districts                        2022 local …
 6 TYPE155 2022 local authorities: counties                         2022 local …
 7 TYPE168 2021 national parks                                      2021 nation…
 8 TYPE423 local authorities: county / unitary (as of April 2023)   local autho…
 9 TYPE424 local authorities: district / unitary (as of April 2023) local autho…
10 TYPE459 local enterprise partnerships (as of April 2021)         local enter…
11 TYPE480 regions                                                  regions     
12 TYPE499 countries                                                countries   
# … with abbreviated variable name ¹​description.en</code></pre>
</div>
</div>
<p>So there are a variety of different geographic levels at which we can download the dataset, including LSOA - see <code>2021 super output areas - lower layer</code>. Notice how the ID for LSOAs is <code>TYPE151</code>.</p>
<p>Those steps we have just performed basically give us everything we need to download the dataset directly from the NOMIS API using the package, instead of downloading the .zip files directly. Let’s download the file - it could take a while! If you don’t understand any of the specific inputs to this line of code, feel free to shout Patrick to talk it through.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Download the file</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>db_v2 <span class="ot">&lt;-</span> <span class="fu">nomis_get_data</span>(<span class="at">id =</span> <span class="st">"NM_2078_1"</span>, <span class="at">time =</span> <span class="st">"latest"</span>, <span class="at">geography =</span> <span class="fu">c</span>(<span class="st">"TYPE151"</span>), <span class="at">measures =</span> <span class="st">"20301"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Retrieving additional pages 1 of 17</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Retrieving additional pages 2 of 17</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Retrieving additional pages 3 of 17</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Retrieving additional pages 4 of 17</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Retrieving additional pages 5 of 17</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Retrieving additional pages 6 of 17</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Retrieving additional pages 7 of 17</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Retrieving additional pages 8 of 17</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Retrieving additional pages 9 of 17</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Retrieving additional pages 10 of 17</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Retrieving additional pages 11 of 17</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Retrieving additional pages 12 of 17</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Retrieving additional pages 13 of 17</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Retrieving additional pages 14 of 17</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Retrieving additional pages 15 of 17</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Retrieving additional pages 16 of 17</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Retrieving additional pages 17 of 17</code></pre>
</div>
</div>
<p>The format the data is presented in is not the most intuitive, so those reshaping skills we acquired yesterday are going to come in handy here again!</p>
<p>Firstly, let’s get the columns we need for our analysis - LSOA codes, the different modes of transport and the actual reported values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Select columns of interest</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>db_clean <span class="ot">&lt;-</span> db_v2 <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOGRAPHY_CODE, C2021_TTWMETH_12_NAME, OBS_VALUE) </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Inspect</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(db_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  GEOGRAPHY_CODE C2021_TTWMETH_12_NAME                                   OBS_V…¹
  &lt;chr&gt;          &lt;chr&gt;                                                     &lt;dbl&gt;
1 E01011954      Total: All usual residents aged 16 years and over in e…   100  
2 E01011954      Work mainly at or from home                                11.9
3 E01011954      Underground, metro, light rail, tram                        0  
4 E01011954      Train                                                       0.3
5 E01011954      Bus, minibus or coach                                       4.1
6 E01011954      Taxi                                                        2  
# … with abbreviated variable name ¹​OBS_VALUE</code></pre>
</div>
</div>
<p>So as you can see from the table, it’s actually in a long format, whereas we might want it to be in a wide format, where each column is the % of people using each transport mode. Let’s use the <code>pivot_wider()</code> command to change this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Go from long to wide</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>db_clean <span class="ot">&lt;-</span> db_clean <span class="sc">%&gt;%</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> C2021_TTWMETH_12_NAME, <span class="at">values_from =</span> OBS_VALUE)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Inspect</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(db_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 13
  GEOGRAPH…¹ Total…² Work …³ Under…⁴ Train Bus, …⁵  Taxi Motor…⁶ Drivi…⁷ Passe…⁸
  &lt;chr&gt;        &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1 E01011954      100    11.9     0     0.3     4.1   2       0.3    63.6     7.5
2 E01011969      100    14.7     0     0.9     2.9   0.7     0.2    67.6     6.7
3 E01011970      100    19.5     0     1.5     2.7   0.6     0.8    65.5     5.4
4 E01011971      100    19       0     0.7     1.6   0.5     0      68.1     5.6
5 E01033465      100    22.2     0.2   1       1.5   1.1     0.1    65.5     3.6
6 E01033467      100    20.6     0.3   0.5     2.3   1.2     0      67.1     4  
# … with 3 more variables: Bicycle &lt;dbl&gt;, `On foot` &lt;dbl&gt;,
#   `Other method of travel to work` &lt;dbl&gt;, and abbreviated variable names
#   ¹​GEOGRAPHY_CODE,
#   ²​`Total: All usual residents aged 16 years and over in employment the week before the census`,
#   ³​`Work mainly at or from home`, ⁴​`Underground, metro, light rail, tram`,
#   ⁵​`Bus, minibus or coach`, ⁶​`Motorcycle, scooter or moped`,
#   ⁷​`Driving a car or van`, ⁸​`Passenger in a car or van`</code></pre>
</div>
</div>
<p>Great, that’s worked! You’ll also notice the number of rows of db_clean matches that of db (which was the file we unzipped at the start of the practical).</p>
<p>Some final data cleaning steps:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Tidy up the dataset</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>db_final <span class="ot">&lt;-</span> db_clean <span class="sc">%&gt;%</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"LSOA21CD"</span>, <span class="st">"total"</span>, <span class="st">"work_from_home"</span>, <span class="st">"underground_metro"</span>, <span class="st">"train"</span>, <span class="st">"bus_minibus_coach"</span>, </span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>             <span class="st">"taxi"</span>, <span class="st">"motorcycle"</span>, <span class="st">"car_driving"</span>, <span class="st">"car_passenger"</span>, <span class="st">"bicycle"</span>, <span class="st">"foot"</span>, <span class="st">"other"</span>)) <span class="do">## set new names</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And then we can easily produce one of the visualisations from yesterday:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Reproduce the scatter plot from yesterday's class</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> db_final, <span class="fu">aes</span>(<span class="at">x =</span> work_from_home, <span class="at">y =</span> car_driving)) <span class="sc">+</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">size =</span> <span class="fl">0.35</span>) <span class="sc">+</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Population who work from home (%)"</span>, <span class="at">y =</span> <span class="st">"Population who drive to work (%)"</span>,</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Data: UK Census (2021) - 'Method of travel to work' (ts061)"</span>) <span class="sc">+</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="03_dashboards-api_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Nice! You have now learned how to programmatically use the API to scrape data from NOMIS, bypassing the need to download and unzip the files directly. Now, some independent tasks to check you can reproduce the steps.</p>
<section id="independent-exercise---over-to-you" class="level3">
<h3 class="anchored" data-anchor-id="independent-exercise---over-to-you">Independent exercise - Over to you!</h3>
<ol type="1">
<li>Experiment with downloading a different dataset using the nomisr package, and clean it.</li>
<li>Produce an interesting visualisation using your chosen dataset.</li>
<li>(<em>optional</em>) See if you can attach the LAD names to your dataset, and produce a visualisation that examines LAD differences in your chosen dataset - recommend you choose a dataset at either LSOA or MSOA geography to use yesterday’s lookup table. If you are unsure of how to do this, you will need to go back to <code>Day 2 - Data Visualisation</code>.</li>
</ol>
</section>
</section>
<section id="building-dashboards-in-r" class="level2">
<h2 class="anchored" data-anchor-id="building-dashboards-in-r">Building Dashboards in R</h2>
<p>Dashboards are often a great way to share results and analyses with others. There are a number of ways you can build dashboards in R, including:</p>
<ol type="1">
<li>Using markdown (<code>flexdashboard</code> R package)</li>
<li>Using R shiny.</li>
</ol>
<p>The former offers you to create a dashboard with panels and pages very easily, and has significant advantages over R Shiny:</p>
<ol type="1">
<li>Minimal coding required.</li>
<li>Dashboard can be distributed as the .html file, with no server required.</li>
<li>Other packages can hook into the dashboard to add interactivity.</li>
</ol>
<section id="getting-started" class="level3">
<h3 class="anchored" data-anchor-id="getting-started">Getting started</h3>
<p>To build a dashboard using R markdown, we will need to use an alternate type of computational workbook - thus far we have been working with Quarto files (.qmd), but now we need to switch to the format that supports “Flex Dashboards”.</p>
<p>However, <code>flexdashboard</code> runs into problems when linked to an existing R project, especially one which is hooked up to Quarto.</p>
<p><strong>Important</strong> So for this part of the project please create a new directory where you want to build your dashboard. For example, I’ve created a new folder called ‘Dashboard’, which is where I will be building my dashboard. Also, make sure to copy some of the datasets we have been using into this new directory:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/04/directory.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">New Directory</figcaption><p></p>
</figure>
</div>
<p>The final step is to create a new file which will be used to build your dashboard. In R, Go to <strong>File</strong> &gt; <strong>New File</strong> &gt; <strong>R Markdown</strong> &gt; <strong>From Template</strong> &gt; <strong>Flex Dashboard</strong> (see below).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/04/file.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">New File</figcaption><p></p>
</figure>
</div>
<p>The file should open up automatically, and should look the one below:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/04/dashboard-raw.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Blank Dashboard Template</figcaption><p></p>
</figure>
</div>
<p>Now save it <strong>inside your new folder</strong> as something you can remember - e.g., dashboard.Rmd. It is vital that this new .Rmd is saved within your new folder, which should now look like this:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/04/complete.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Full Directory</figcaption><p></p>
</figure>
</div>
<p>When you open up the .Rmd file, you should be able to see the ‘Knit’ button as below. If you instead see the ‘Render’ button, you’ve not saved the .rmd in your new directory. Speak to Patrick if you run into problems here.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/04/knit.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Knit Button</figcaption><p></p>
</figure>
</div>
</section>
<section id="introduction-to-flex-dashboard" class="level3">
<h3 class="anchored" data-anchor-id="introduction-to-flex-dashboard">Introduction to Flex Dashboard</h3>
<p>For the remainder of the practical, you need to be working in your new .Rmd file. This is where you will build and deploy your dashboard, so please make sure you are working in this file - ‘dashboard.Rmd’.</p>
<p>Inside the file you will notice a couple of different things:</p>
<ol type="1">
<li>Code blocks - you will see code blocks like those you have been running in this document, which can be used to run lines of code easily.</li>
<li>YAML header - at the top of the new file is a YAML header, which is where you can set up the basic metadata for the dashboard.</li>
</ol>
<p>Have a go at changing your YAML header to the following:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/04/yaml.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">YAML</figcaption><p></p>
</figure>
</div>
<p>These parameters are doing the following:</p>
<ul>
<li>title: sets a title to appear at the top of the dashboard.</li>
<li>orientation: determines whether charts should be aligned in rows or columns</li>
<li>vertical_layout: sets the dashboard to fill available browser height.</li>
</ul>
<p>Press ‘Knit’ and see what happens…</p>
<p>R should open up a new window that looks like this:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/04/first.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">First Dashboard</figcaption><p></p>
</figure>
</div>
<p>So you can see that the dashboard has three panes set up to host different types of visualisation. In the .Rmd file you’ll notice that each <code>##</code> denotes the start of a new column, and each <code>###</code> denotes a new pane for visualisation.</p>
<p>Let’s change the layout slightly, to create a grid of four equally sized panes. To do this you need to:</p>
<ol type="1">
<li>Change the data-width parameter to be equal for both columns</li>
<li>Add a second pane under column one</li>
</ol>
<p>Here is what the code looks like:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/04/resize-code.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Code</figcaption><p></p>
</figure>
</div>
<p>Now press ‘Knit’ again, and see what has changed:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/04/resize-out.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Resized</figcaption><p></p>
</figure>
</div>
<p>Cool! So the dashboard layout is set up and ready to go!</p>
</section>
<section id="independent-exercise---over-to-you-1" class="level3">
<h3 class="anchored" data-anchor-id="independent-exercise---over-to-you-1">Independent exercise - Over to you!</h3>
<ol type="1">
<li>Swap the orientation to be columns</li>
<li>See if you can set up the dashboard to be structured as 1 large panel on the left, and three on the right.</li>
<li>(<em>optional</em>) Change the section headers for each pane to list some potential visualisations you might put in each, based on yesterday’s class.</li>
</ol>
<p>SOLUTION:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/04/solution1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Solution</figcaption><p></p>
</figure>
</div>
</section>
<section id="embedding-visualisations" class="level3">
<h3 class="anchored" data-anchor-id="embedding-visualisations">Embedding visualisations</h3>
<p>When building a dashboard, a key component will be adding in a number of visualisations to enhance the information being conveyed by the dashboard. As you have seen so far, <code>flexdashboard</code> creates panes to host plots and visualisations on.</p>
<p>However, the visualisations need to be produced within the .Rmd file before they can be displayed on the dashboard itself. This is where you can use code chunks within the .Rmd file to re-run some of the analyses we did yesterday to produce visuals for the dashboard.</p>
<p>The code chunks need to be placed before the dashboard structural parameters - i.e.&nbsp;before the ## Column commands in the script. Have a look at the example below where we read in and clean the census data we were using on Day 2:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/04/code-example.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">How to insert code</figcaption><p></p>
</figure>
</div>
<p>Then, once you have the read the data in you can produce one of the visualisations we made yesterday - such as the scatter plot we made yesterday:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/04/code-example2.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Make a plot</figcaption><p></p>
</figure>
</div>
<p>Now the final step is to think about embedding this plot so it can be displayed on the plot. To do this, all you need to do is call the plot in one of the code blocks which are set up to host visualisations, see below:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/04/code-example3.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Embed a plot</figcaption><p></p>
</figure>
</div>
<p>Now hit ‘Knit’ and you should see this plot on the dashboard:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/04/dashboard-p1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">First stage</figcaption><p></p>
</figure>
</div>
</section>
<section id="independent-exericse---over-to-you-30---45-mins" class="level3">
<h3 class="anchored" data-anchor-id="independent-exericse---over-to-you-30---45-mins">Independent exericse - Over to you!! (30 - 45 mins)</h3>
<p>Have a go at embedding some more visualisations on the dashboard. To do this you will need to reproduce lots of the analysis you did on Day 2.</p>
<p>Below I’ve included something that I put together, which is something you could aim to try and generate…</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/04/dashboard-final.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Transport Dashboard</figcaption><p></p>
</figure>
</div>
</section>
</section>
<section id="other-useful-reporting-techniques" class="level2">
<h2 class="anchored" data-anchor-id="other-useful-reporting-techniques">Other Useful Reporting Techniques</h2>
<p>We have shown you the power of using R and Quarto for generating computational workbooks where you can view both the figures/outputs and code used to generate them, all at once.</p>
<section id="constructing-reports" class="level3">
<h3 class="anchored" data-anchor-id="constructing-reports">Constructing Reports</h3>
<p>The .html files that render alongside these .qmd files can be seen as ‘reports’ in a way. However, there is a whole host of design-related modifications you can make to the .qmd file which will enhance the appearance of the output report.</p>
<p>There is lots of useful information online about creating nice reports using R markdown - including this one from <a href="https://epirhandbook.com/en/reports-with-r-markdown.html">The Epidemiologist R Handbook</a>.</p>
</section>
<section id="routine-reporting" class="level3">
<h3 class="anchored" data-anchor-id="routine-reporting">Routine Reporting</h3>
<p>The Epidemiologist Handbook also has a really nice section on how to use R to run reports routinely, using the reportfactory R package. Have a a look ath the <a href="https://epirhandbook.com/en/organizing-routine-reports.html">Organising routing reports</a> guide if you are interested in learning more about this!</p>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>